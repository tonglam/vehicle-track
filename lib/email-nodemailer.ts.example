// Alternative: Nodemailer (for SMTP, Gmail, etc.)
// Install: bun add nodemailer
// Install types: bun add -D @types/nodemailer

import nodemailer from "nodemailer";

// Create transporter
const transporter = nodemailer.createTransporter({
  host: process.env.SMTP_HOST, // e.g., smtp.gmail.com
  port: parseInt(process.env.SMTP_PORT || "587"),
  secure: process.env.SMTP_SECURE === "true", // true for 465, false for other ports
  auth: {
    user: process.env.SMTP_USER,
    pass: process.env.SMTP_PASS,
  },
});

export async function sendPasswordResetEmail({
  to,
  resetUrl,
  userName,
}: {
  to: string;
  resetUrl: string;
  userName?: string;
}) {
  try {
    await transporter.sendMail({
      from: process.env.EMAIL_FROM || '"Vehicle Track" <noreply@yourdomain.com>',
      to,
      subject: "Reset Your Password - Vehicle Track",
      html: `
        <h1>Reset Your Password</h1>
        <p>Hello${userName ? ` ${userName}` : ""},</p>
        <p>Click the link below to reset your password:</p>
        <a href="${resetUrl}">Reset Password</a>
        <p>This link expires in 1 hour.</p>
      `,
      text: `Reset your password: ${resetUrl}`,
    });

    console.log("✅ Email sent via SMTP to:", to);
  } catch (error) {
    console.error("❌ SMTP error:", error);
    throw error;
  }
}

// For Gmail, use these settings:
// SMTP_HOST=smtp.gmail.com
// SMTP_PORT=587
// SMTP_SECURE=false
// SMTP_USER=your-gmail@gmail.com
// SMTP_PASS=your-app-specific-password
